name: Blue-Green Deployment

on:
    push:

jobs:
    build-and-push:
        runs-on: ubuntu-latest
        outputs:
            TAG: ${{ steps.set-tag.outputs.TAG }}
        steps:
            - name: Checkout Repository
              uses: actions/checkout@v3

            - name: Set Image Tag
              id: set-tag
              run: |
                  TAG=$(echo ${GITHUB_SHA:-latest} | cut -c1-7)
                  echo "TAG=$TAG" >> $GITHUB_OUTPUT  # GITHUB_OUTPUT에 저장
                  echo "Set TAG=$TAG"

            - name: Debug TAG in build-and-push
              run: echo "TAG=${{ steps.set-tag.outputs.TAG }}"

    deploy:
        needs: [build-and-push]
        runs-on: ubuntu-latest
        env:
            TAG: ${{ needs.build-and-push.outputs.TAG }}
        steps:
            - name: Debug TAG in deploy
              run: echo "TAG=${{ env.TAG }}"
